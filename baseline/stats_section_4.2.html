<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Section 4.2 Statistical Methods &mdash; CytoAtlas Reports</title>
<style>
    :root {
        --bg: #ffffff;
        --fg: #1a1a2e;
        --accent: #2563eb;
        --accent-hover: #1d4ed8;
        --card-bg: #f8fafc;
        --card-border: #e2e8f0;
        --muted: #64748b;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: var(--fg);
        background: var(--bg);
        line-height: 1.6;
    }
    header {
        border-bottom: 1px solid var(--card-border);
        padding: 2rem 1.5rem 1.5rem;
        max-width: 960px;
        margin: 0 auto;
    }
    header h1 { font-size: 1.8rem; font-weight: 700; }
    header p { color: var(--muted); margin-top: 0.25rem; }
    main {
        max-width: 960px;
        margin: 0 auto;
        padding: 2rem 1.5rem 4rem;
    }
    footer {
        max-width: 960px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--card-border);
        font-size: 0.8rem;
        color: var(--muted);
    }

    /* Navigation */
    .back-link {
        display: inline-block;
        margin-bottom: 1.5rem;
        padding: 0.35em 0.75em;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 6px;
        font-size: 0.85rem;
        color: var(--accent);
        text-decoration: none;
        transition: border-color 0.15s;
    }
    .back-link:hover { border-color: var(--accent); }

    /* Headings */
    h2 {
        font-size: 1.4rem;
        margin: 2.5rem 0 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--accent);
    }
    h3 { font-size: 1.1rem; margin: 1.5rem 0 0.6rem; color: var(--accent); }
    p { margin-bottom: 0.75rem; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Tables */
    table { width: 100%; border-collapse: collapse; margin: 1rem 0 1.25rem; font-size: 0.875rem; }
    th, td { padding: 0.6rem 0.85rem; text-align: left; border: 1px solid var(--card-border); }
    th { background: var(--card-bg); font-weight: 600; }
    tr:hover { background: var(--card-bg); }

    /* Code */
    code {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        padding: 0.15em 0.4em;
        border-radius: 4px;
        font-size: 0.85rem;
        font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, monospace;
    }

    /* Significance markers */
    .sig { font-weight: bold; }
    .sig-yes { color: #059669; }
    .sig-no { color: var(--muted); }

    /* Lists */
    ul, ol { margin: 0.5rem 0 1rem 1.5rem; }
    li { margin-bottom: 0.4rem; }

    .page-title {
        font-size: 1.6rem;
        font-weight: 700;
        margin-top: 0;
        margin-bottom: 1.5rem;
    }
</style>
</head>
<body>

<header>
    <h1>CytoAtlas Reports</h1>
    <p>Pan-Disease Single-Cell Cytokine Activity Atlas &mdash; reporting hub</p>
</header>

<main>

<a href="index.html" class="back-link">&larr; Back to report</a>

<div class="page-title">Section 4.2: Cross-Dataset Comparison &mdash; Statistical Methods</div>

<h2>Overview</h2>
<p>Section 4.2 compares the Spearman &rho; distributions of CytoSig and SecAct across 6 independent atlases using <strong>independence-corrected</strong> statistics. For GTEx (29 tissues) and TCGA (33 cancer types), each target&rsquo;s representative &rho; is the <strong>median across per-tissue/per-cancer values</strong> (median-of-medians). For donor-only datasets (CIMA, Inflammation Main, scAtlas Normal/Cancer), each target already has one &rho;. Two complementary statistical tests are used, corresponding to the two tabs in the interactive figure.</p>

<h2>Total Comparison (Mann&ndash;Whitney U Test)</h2>

<h3>Rationale</h3>
<p>The <strong>Mann&ndash;Whitney U test</strong> (also called the Wilcoxon rank-sum test) is a non-parametric test comparing two independent samples. It tests whether one distribution is stochastically greater than the other.</p>
<p>This test is appropriate here because:</p>
<ul>
<li>CytoSig and SecAct measure <strong>different sets of proteins</strong> &mdash; there is no natural pairing between the ~43 CytoSig targets and ~1,170 SecAct targets.</li>
<li>The sample sizes are <strong>unequal</strong> (43 vs ~1,170).</li>
<li>The &rho; distributions are not necessarily normal, so a non-parametric test is preferred.</li>
</ul>

<h3>Procedure</h3>
<ol>
<li>For GTEx and TCGA: for each target, compute the median &rho; across tissues/cancers (excluding &ldquo;all&rdquo; and &ldquo;unmappable&rdquo; strata). This yields one representative &rho; per target.</li>
<li>For CIMA, Inflammation Main, scAtlas Normal, scAtlas Cancer: each target already has one &rho; at the independent donor/tumor level.</li>
<li>For each atlas, collect the representative &rho; values for all CytoSig targets and all SecAct targets.</li>
<li>Apply the two-sided Mann&ndash;Whitney U test (<code>scipy.stats.mannwhitneyu</code>, <code>alternative='two-sided'</code>).</li>
<li>Apply <strong>Benjamini&ndash;Hochberg (BH) FDR correction</strong> across all 6 atlases to control the false discovery rate.</li>
<li>Report the U statistic, raw p-value, and BH-corrected q-value.</li>
</ol>

<h3>Results</h3>
<table>
<tr><th>Atlas</th><th>n<sub>CS</sub></th><th>n<sub>SA</sub></th><th>U statistic</th><th>p<sub>raw</sub></th><th>q<sub>BH</sub></th><th>Sig.</th></tr>
<tr><td>GTEx</td><td>43</td><td>1,132</td><td>16,705.0</td><td>4.76 &times; 10<sup>&minus;4</sup></td><td>9.51 &times; 10<sup>&minus;4</sup></td><td class="sig sig-yes">***</td></tr>
<tr><td>TCGA</td><td>41</td><td>1,085</td><td>16,142.0</td><td>2.85 &times; 10<sup>&minus;3</sup></td><td>4.27 &times; 10<sup>&minus;3</sup></td><td class="sig sig-yes">**</td></tr>
<tr><td>CIMA</td><td>43</td><td>1,161</td><td>20,155.0</td><td>3.18 &times; 10<sup>&minus;2</sup></td><td>3.81 &times; 10<sup>&minus;2</sup></td><td class="sig sig-yes">*</td></tr>
<tr><td>Inflammation Main</td><td>33</td><td>805</td><td>14,101.0</td><td>5.48 &times; 10<sup>&minus;1</sup></td><td>5.48 &times; 10<sup>&minus;1</sup></td><td class="sig sig-no">ns</td></tr>
<tr><td>scAtlas (Normal)</td><td>43</td><td>1,140</td><td>15,976.0</td><td>1.04 &times; 10<sup>&minus;4</sup></td><td>3.13 &times; 10<sup>&minus;4</sup></td><td class="sig sig-yes">***</td></tr>
<tr><td>scAtlas (Cancer)</td><td>43</td><td>1,140</td><td>14,822.0</td><td>1.06 &times; 10<sup>&minus;5</sup></td><td>6.36 &times; 10<sup>&minus;5</sup></td><td class="sig sig-yes">***</td></tr>
</table>

<h3>Notes on independence correction</h3>
<p>Sample sizes are now corrected to reflect one &rho; per target per atlas:</p>
<ul>
<li><strong>GTEx</strong>: Each target&rsquo;s representative &rho; = median across 29 tissues (median-of-medians). n<sub>CytoSig</sub> = 43 targets (not 43 &times; 29 = 1,247 tissue-target pairs).</li>
<li><strong>TCGA</strong>: Each target&rsquo;s representative &rho; = median across 33 cancer types. n<sub>CytoSig</sub> = 41 targets.</li>
<li><strong>CIMA</strong>: One &rho; per target at donor_only level. n<sub>CytoSig</sub> = 43.</li>
<li><strong>Inflammation Main</strong>: One &rho; per target at donor_only level. n<sub>CytoSig</sub> = 33 (smaller target set than other atlases).</li>
<li><strong>scAtlas Normal/Cancer</strong>: One &rho; per target at donor_only/tumor_only level. n = 43 CytoSig, 1,140 SecAct. Previous analysis used inflated n from donor &times; organ level (e.g., scAtlas Normal was 1,013 = 43 &times; ~24 organs, not independent).</li>
</ul>

<h2>Matched Comparison (Wilcoxon Signed-Rank Test)</h2>

<h3>Rationale</h3>
<p>The <strong>Wilcoxon signed-rank test</strong> is a non-parametric paired test. It tests whether the median of the paired differences is zero.</p>
<p>This test is appropriate here because:</p>
<ul>
<li>32 targets are shared between CytoSig and SecAct after full alias resolution (see below). 30 pairs for TCGA (IFNL1/IL36A absent); 27 pairs for Inflammation Main (smaller target set).</li>
<li>Each shared target serves as <strong>its own control</strong> &mdash; one &rho; from CytoSig and one from SecAct for the same cytokine.</li>
<li>This is a <strong>paired design</strong> with 27&ndash;32 pairs depending on the atlas.</li>
</ul>

<h3>The 32 shared targets (after alias resolution)</h3>
<p><strong>22 direct matches</strong> (same name in both signatures): BDNF, BMP2, BMP4, BMP6, CXCL12, FGF2, GDF11, HGF, IFNG, IL10, IL15, IL1A, IL1B, IL21, IL27, IL6, LIF, LTA, OSM, TGFB1, TGFB3, VEGFA</p>
<p><strong>10 alias matches</strong> (CytoSig common name &rarr; SecAct HGNC gene symbol): Activin&nbsp;A&rarr;INHBA, CD40L&rarr;CD40LG, GCSF&rarr;CSF3, GMCSF&rarr;CSF2, IFNL&rarr;IFNL1, IL36&rarr;IL36A, MCSF&rarr;CSF1, TNFA&rarr;TNF, TRAIL&rarr;TNFSF10, TWEAK&rarr;TNFSF12</p>
<p><strong>TCGA</strong>: 30 of 32 pairs (IFNL1 and IL36A absent from TCGA&rsquo;s 20.5K gene set). <strong>Inflammation Main</strong>: 27 of 32 pairs (BDNF, BMP4, CXCL12, GCSF, IL36 absent from this dataset).</p>

<h3>Procedure</h3>
<ol>
<li>For GTEx/TCGA: use the median-of-medians &rho; per target (same as the Total comparison). For other atlases: use the direct independent-level &rho;.</li>
<li>For each atlas, collect the Spearman &rho; for each of the 32 shared targets (or available subset) in both CytoSig and SecAct, using alias resolution to match names.</li>
<li>Compute the paired differences: &Delta;<sub>i</sub> = &rho;<sub>SecAct,i</sub> &minus; &rho;<sub>CytoSig,i</sub> for each target i.</li>
<li>Apply the two-sided Wilcoxon signed-rank test (<code>scipy.stats.wilcoxon</code>) on the non-zero differences.</li>
<li>Apply <strong>Benjamini&ndash;Hochberg (BH) FDR correction</strong> across all 6 atlases.</li>
<li>Report the raw p-value and BH-corrected q-value.</li>
</ol>

<h3>Results</h3>
<table>
<tr><th>Atlas</th><th>n<sub>pairs</sub></th><th>p<sub>raw</sub></th><th>q<sub>BH</sub></th><th>Sig.</th></tr>
<tr><td>GTEx</td><td>32</td><td>3.54 &times; 10<sup>&minus;5</sup></td><td>5.31 &times; 10<sup>&minus;5</sup></td><td class="sig sig-yes">***</td></tr>
<tr><td>TCGA</td><td>30</td><td>3.24 &times; 10<sup>&minus;6</sup></td><td>1.94 &times; 10<sup>&minus;5</sup></td><td class="sig sig-yes">***</td></tr>
<tr><td>CIMA</td><td>32</td><td>2.28 &times; 10<sup>&minus;2</sup></td><td>2.73 &times; 10<sup>&minus;2</sup></td><td class="sig sig-yes">*</td></tr>
<tr><td>Inflammation Main</td><td>27</td><td>1.41 &times; 10<sup>&minus;1</sup></td><td>1.41 &times; 10<sup>&minus;1</sup></td><td class="sig sig-no">ns</td></tr>
<tr><td>scAtlas (Normal)</td><td>32</td><td>3.54 &times; 10<sup>&minus;5</sup></td><td>5.31 &times; 10<sup>&minus;5</sup></td><td class="sig sig-yes">***</td></tr>
<tr><td>scAtlas (Cancer)</td><td>32</td><td>3.54 &times; 10<sup>&minus;5</sup></td><td>5.31 &times; 10<sup>&minus;5</sup></td><td class="sig sig-yes">***</td></tr>
</table>

<h2>Multiple Testing Correction</h2>
<p>Both the Mann&ndash;Whitney U and Wilcoxon signed-rank tests are performed independently for each of 6 atlases. To control the false discovery rate, <strong>Benjamini&ndash;Hochberg (BH) FDR correction</strong> is applied across the 6 p-values within each test type. The interactive figure displays BH-corrected q-values.</p>
<p>Implementation: <code>statsmodels.stats.multitest.multipletests(pvals, method='fdr_bh')</code></p>

<h2>Significance Thresholds</h2>
<table>
<tr><th>Symbol</th><th>Threshold</th></tr>
<tr><td>***</td><td>q<sub>BH</sub> &lt; 0.001</td></tr>
<tr><td>**</td><td>q<sub>BH</sub> &lt; 0.01</td></tr>
<tr><td>*</td><td>q<sub>BH</sub> &lt; 0.05</td></tr>
<tr><td>ns</td><td>q<sub>BH</sub> &ge; 0.05 (not significant)</td></tr>
</table>

<h2>Software</h2>
<p>All tests computed using <code>scipy.stats</code> (Python). Mann&ndash;Whitney U: <code>scipy.stats.mannwhitneyu(cytosig_rhos, secact_rhos, alternative='two-sided')</code>. Wilcoxon signed-rank: <code>scipy.stats.wilcoxon(cytosig_rhos, secact_rhos, alternative='two-sided')</code> on paired values. Multiple testing correction: <code>statsmodels.stats.multitest.multipletests(pvals, method='fdr_bh')</code> across 6 atlases.</p>

</main>

<footer>
    CytoAtlas &mdash; generated reports are served via GitHub Pages
</footer>

</body>
</html>
