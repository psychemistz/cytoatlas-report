<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Section 4.3 Statistical Methods &mdash; CytoAtlas Reports</title>
<style>
    :root {
        --bg: #ffffff;
        --fg: #1a1a2e;
        --accent: #2563eb;
        --accent-hover: #1d4ed8;
        --card-bg: #f8fafc;
        --card-border: #e2e8f0;
        --muted: #64748b;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        color: var(--fg);
        background: var(--bg);
        line-height: 1.6;
    }
    header {
        border-bottom: 1px solid var(--card-border);
        padding: 2rem 1.5rem 1.5rem;
        max-width: 960px;
        margin: 0 auto;
    }
    header h1 { font-size: 1.8rem; font-weight: 700; }
    header p { color: var(--muted); margin-top: 0.25rem; }
    main {
        max-width: 960px;
        margin: 0 auto;
        padding: 2rem 1.5rem 4rem;
    }
    footer {
        max-width: 960px;
        margin: 0 auto;
        padding: 1rem 1.5rem;
        border-top: 1px solid var(--card-border);
        font-size: 0.8rem;
        color: var(--muted);
    }

    /* Navigation */
    .back-link {
        display: inline-block;
        margin-bottom: 1.5rem;
        padding: 0.35em 0.75em;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 6px;
        font-size: 0.85rem;
        color: var(--accent);
        text-decoration: none;
        transition: border-color 0.15s;
    }
    .back-link:hover { border-color: var(--accent); }

    /* Headings */
    h2 {
        font-size: 1.4rem;
        margin: 2.5rem 0 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--accent);
    }
    h3 { font-size: 1.1rem; margin: 1.5rem 0 0.6rem; color: var(--accent); }
    p { margin-bottom: 0.75rem; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Tables */
    table { width: 100%; border-collapse: collapse; margin: 1rem 0 1.25rem; font-size: 0.875rem; }
    th, td { padding: 0.6rem 0.85rem; text-align: left; border: 1px solid var(--card-border); }
    th { background: var(--card-bg); font-weight: 600; }
    tr:hover { background: var(--card-bg); }

    /* Code */
    code {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        padding: 0.15em 0.4em;
        border-radius: 4px;
        font-size: 0.85rem;
        font-family: 'JetBrains Mono', 'Fira Code', ui-monospace, monospace;
    }

    /* Significance markers */
    .sig { font-weight: bold; }
    .sig-yes { color: #059669; }
    .sig-no { color: var(--muted); }

    /* Lists */
    ul, ol { margin: 0.5rem 0 1rem 1.5rem; }
    li { margin-bottom: 0.4rem; }

    .page-title {
        font-size: 1.6rem;
        font-weight: 700;
        margin-top: 0;
        margin-bottom: 1.5rem;
    }
</style>
</head>
<body>

<header>
    <h1>CytoAtlas Reports</h1>
    <p>Pan-Disease Single-Cell Cytokine Activity Atlas &mdash; reporting hub</p>
</header>

<main>

<a href="index.html" class="back-link">&larr; Back to report</a>

<div class="page-title">Section 4.3: Per-Tissue and Per-Cancer Stratified Validation &mdash; Statistical Methods</div>

<h2>Overview</h2>
<p>Per-tissue (GTEx) and per-cancer (TCGA) validation reveals tissue/cancer-specific variation in expression&ndash;activity correlations. Statistical tests compare CytoSig vs SecAct within each stratum, with <strong>BH-FDR correction</strong> applied across all strata within each dataset. This stratified analysis complements the aggregate cross-dataset comparison in Section 4.2 by identifying which specific tissues or cancer types drive the overall differences.</p>

<h2>Datasets with Per-Stratum Breakdowns</h2>
<table>
<tr><th>Dataset</th><th>Number of Strata</th><th>Stratification Level</th><th>Samples per Stratum</th><th>Tier Classification</th></tr>
<tr><td>GTEx</td><td>29 tissues</td><td><code>by_tissue</code></td><td>47&ndash;3,234 donors per tissue</td><td>All Tier A (&ge;30)</td></tr>
<tr><td>TCGA</td><td>33 cancer types</td><td><code>primary_by_cancer</code></td><td>36&ndash;1,092 per type</td><td>All Tier A (&ge;30)</td></tr>
<tr><td>scAtlas Normal</td><td>19 organs</td><td><code>donor_organ</code></td><td>10&ndash;124 donors per organ</td><td>7 Tier A (&ge;30), 12 Tier B (&lt;30)</td></tr>
<tr><td>scAtlas Cancer</td><td>17 cancer types</td><td><code>tumor_by_cancer</code></td><td>10&ndash;88 tumors per type</td><td>9 Tier A (&ge;30), 8 Tier B (&lt;30)</td></tr>
</table>

<h2>Statistical Tests Per Stratum</h2>
<p>For each tissue/cancer within each dataset, two complementary tests are applied to the Spearman &rho; distributions:</p>

<h3>Total Comparison (Mann&ndash;Whitney U Test)</h3>
<p>Within each stratum, a <strong>Mann&ndash;Whitney U test</strong> compares all CytoSig target &rho; values against all SecAct target &rho; values. This tests whether one method produces stochastically higher correlations than the other for a given tissue or cancer type.</p>
<ul>
<li>Two-sided test: <code>scipy.stats.mannwhitneyu(secact_rhos, cytosig_rhos, alternative='two-sided')</code></li>
<li>Sample sizes are unequal (~43 CytoSig targets vs ~1,100+ SecAct targets per stratum).</li>
<li>Each target contributes one &rho; value per stratum (one correlation across the donors/tumors in that stratum).</li>
</ul>

<h3>Matched Comparison (Wilcoxon Signed-Rank Test)</h3>
<p>Within each stratum, a <strong>Wilcoxon signed-rank test</strong> compares the paired &rho; values for the 32 shared targets (after alias resolution). For TCGA, 30 pairs are available (IFNL1 and IL36A absent from TCGA&rsquo;s gene set).</p>
<ul>
<li>Paired test: <code>scipy.stats.wilcoxon(differences)</code> on non-zero paired differences.</li>
<li>&Delta;<sub>i</sub> = &rho;<sub>SecAct,i</sub> &minus; &rho;<sub>CytoSig,i</sub> for each shared target i.</li>
<li>This controls for target identity: each cytokine serves as its own control.</li>
</ul>

<h3>Multiple Testing Correction</h3>
<p>Raw p-values from all strata within each dataset are corrected using the <strong>Benjamini&ndash;Hochberg (BH) FDR</strong> procedure:</p>
<ul>
<li><strong>GTEx</strong>: 29 tests (one per tissue) &rarr; BH-FDR correction across 29 p-values.</li>
<li><strong>TCGA</strong>: 33 tests (one per cancer type) &rarr; BH-FDR correction across 33 p-values.</li>
<li><strong>scAtlas Normal</strong>: up to 19 tests (one per organ) &rarr; BH-FDR correction across all tested strata.</li>
<li><strong>scAtlas Cancer</strong>: up to 17 tests (one per cancer type) &rarr; BH-FDR correction across all tested strata.</li>
</ul>
<p>Correction is applied separately for Total and Matched tests. Implementation: <code>statsmodels.stats.multitest.multipletests(pvals, method='fdr_bh')</code>.</p>

<h2>Tier Classification</h2>
<p>Strata are classified by the number of independent samples (donors or tumors) to indicate statistical power:</p>
<table>
<tr><th>Tier</th><th>Sample Count</th><th>Interpretation</th></tr>
<tr><td><strong>Tier A</strong></td><td>&ge;30 independent samples</td><td>Sufficient statistical power for reliable inference</td></tr>
<tr><td><strong>Tier B</strong></td><td>20&ndash;29 samples</td><td>Results shown with reduced confidence markers</td></tr>
<tr><td><em>Excluded</em></td><td>&lt;20 samples</td><td>Excluded from statistical testing due to insufficient power</td></tr>
</table>
<p>All GTEx tissues and TCGA cancer types exceed the Tier A threshold (minimum 36&ndash;47 samples). The tier distinction primarily applies to scAtlas Normal and scAtlas Cancer, where some organs/cancer types have limited donor counts.</p>

<h2>Per-Stratum Results</h2>

<h3>GTEx Per-Tissue Results</h3>
<p>[Full per-tissue results will be computed when the analysis pipeline runs. The table will include 29 rows (one per tissue), with columns for tissue name, n_donors, CytoSig median &rho;, SecAct median &rho;, Mann&ndash;Whitney p-value, Wilcoxon p-value, and BH-FDR-adjusted p-values.]</p>

<h3>TCGA Per-Cancer Results</h3>
<p>[Full per-cancer results will be computed when the analysis pipeline runs. The table will include 33 rows (one per cancer type), with columns for cancer type, n_tumors, CytoSig median &rho;, SecAct median &rho;, Mann&ndash;Whitney p-value, Wilcoxon p-value, and BH-FDR-adjusted p-values.]</p>

<h3>scAtlas Normal Per-Organ Results</h3>
<p>[Full per-organ results will be computed when the analysis pipeline runs. The table will include up to 19 rows (one per organ), with tier classification and columns for organ, n_donors, tier, CytoSig median &rho;, SecAct median &rho;, Mann&ndash;Whitney p-value, Wilcoxon p-value, and BH-FDR-adjusted p-values.]</p>

<h3>scAtlas Cancer Per-Cancer Results</h3>
<p>[Full per-cancer results will be computed when the analysis pipeline runs. The table will include up to 17 rows (one per cancer type), with tier classification and columns for cancer type, n_tumors, tier, CytoSig median &rho;, SecAct median &rho;, Mann&ndash;Whitney p-value, Wilcoxon p-value, and BH-FDR-adjusted p-values.]</p>

<h2>Cross-Platform Comparison (Section 4.3.1)</h2>

<h3>Rationale</h3>
<p>Comparing per-tissue &rho; values across platforms (bulk RNA-seq vs single-cell) provides a concordance check: if expression&ndash;activity correlations reflect genuine biology, tissues with high &rho; in GTEx should also have high &rho; in scAtlas Normal, and TCGA cancer types should track with scAtlas Cancer.</p>

<h3>Methodology</h3>
<ul>
<li><strong>GTEx vs scAtlas Normal</strong>: For tissues present in both datasets (matched by tissue/organ name), compute the Spearman correlation of per-tissue median &rho; values. Each matched tissue contributes one pair of &rho; values (GTEx &rho; vs scAtlas Normal &rho;).</li>
<li><strong>TCGA vs scAtlas Cancer</strong>: For cancer types present in both datasets (matched by cancer type), compute the Spearman correlation of per-cancer median &rho; values. Each matched cancer type contributes one pair of &rho; values.</li>
</ul>
<p>This concordance analysis is performed separately for CytoSig targets and SecAct targets, producing four concordance correlations (2 platform pairs &times; 2 methods).</p>

<h3>Limitations</h3>
<p>Cross-platform concordance should be interpreted with the following caveats:</p>
<ul>
<li><strong>Sample sizes differ</strong>: GTEx tissues have 47&ndash;3,234 donors; scAtlas Normal organs have 10&ndash;124 donors. TCGA cancer types have 36&ndash;1,092 tumors; scAtlas Cancer types have 10&ndash;88 tumors.</li>
<li><strong>Gene sets differ</strong>: Bulk RNA-seq captures ~20,000&ndash;56,000 genes; single-cell data is sparser (~15,000&ndash;25,000 genes after QC).</li>
<li><strong>Normalization differs</strong>: GTEx uses TPM (log2(TPM+1)), TCGA uses RSEM normalized counts (log2(RSEM+1)), and single-cell uses pseudobulk from scRNA-seq counts.</li>
<li><strong>Donor demographics differ</strong>: GTEx donors are post-mortem; TCGA/scAtlas donors are clinical cohorts with different age, sex, and ancestry distributions.</li>
<li><strong>Tissue/cancer matching is approximate</strong>: Anatomical tissue definitions may not map precisely across datasets (e.g., &ldquo;Liver&rdquo; in GTEx vs &ldquo;liver&rdquo; organ in scAtlas Normal).</li>
</ul>

<p>[Cross-platform concordance results will be computed when the analysis pipeline runs. The results will include concordance Spearman &rho; values for each platform pair and method, with scatter plots of per-tissue/per-cancer &rho; values.]</p>

<h2>Significance Thresholds</h2>
<table>
<tr><th>Symbol</th><th>Threshold</th></tr>
<tr><td>***</td><td>p &lt; 0.001</td></tr>
<tr><td>**</td><td>p &lt; 0.01</td></tr>
<tr><td>*</td><td>p &lt; 0.05</td></tr>
<tr><td>ns</td><td>p &ge; 0.05 (not significant)</td></tr>
</table>
<p>For per-stratum tests, significance is assessed on <strong>BH-FDR-adjusted p-values</strong> (q-values), not raw p-values. The thresholds above apply to q-values after correction.</p>

<h2>Software</h2>
<p>All tests computed using Python. Mann&ndash;Whitney U: <code>scipy.stats.mannwhitneyu(secact_rhos, cytosig_rhos, alternative='two-sided')</code>. Wilcoxon signed-rank: <code>scipy.stats.wilcoxon(differences)</code> on non-zero paired differences. BH-FDR correction: <code>statsmodels.stats.multitest.multipletests(pvals, method='fdr_bh')</code>. Cross-platform concordance: <code>scipy.stats.spearmanr</code>.</p>

</main>

<footer>
    CytoAtlas &mdash; generated reports are served via GitHub Pages
</footer>

</body>
</html>
